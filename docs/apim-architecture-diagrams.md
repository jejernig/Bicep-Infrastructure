# API Management Architecture Diagrams

## Shared APIM Mode Architecture

```
┌───────────────────────────────────────────────────────────────┐
│                                                               │
│                   Shared Resource Group                        │
│                                                               │
│  ┌─────────────────────────────────────────────────────────┐  │
│  │                                                         │  │
│  │               Shared APIM Instance                      │  │
│  │                                                         │  │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │  │
│  │  │ Project A   │  │ Project B   │  │ Project C   │     │  │
│  │  │ Namespace   │  │ Namespace   │  │ Namespace   │     │  │
│  │  │             │  │             │  │             │     │  │
│  │  │ /projectA/v1│  │ /projectB/v1│  │ /projectC/v1│     │  │
│  │  │             │  │             │  │             │     │  │
│  │  │ ┌─────────┐ │  │ ┌─────────┐ │  │ ┌─────────┐ │     │  │
│  │  │ │ API 1   │ │  │ │ API 1   │ │  │ │ API 1   │ │     │  │
│  │  │ └─────────┘ │  │ └─────────┘ │  │ └─────────┘ │     │  │
│  │  │             │  │             │  │             │     │  │
│  │  │ ┌─────────┐ │  │ ┌─────────┐ │  │ ┌─────────┐ │     │  │
│  │  │ │ API 2   │ │  │ │ API 2   │ │  │ │ API 2   │ │     │  │
│  │  │ └─────────┘ │  │ └─────────┘ │  │ └─────────┘ │     │  │
│  │  │             │  │             │  │             │     │  │
│  │  └─────────────┘  └─────────────┘  └─────────────┘     │  │
│  │                                                         │  │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │  │
│  │  │ Product A   │  │ Product B   │  │ Product C   │     │  │
│  │  └─────────────┘  └─────────────┘  └─────────────┘     │  │
│  │                                                         │  │
│  │  ┌─────────────────────────────────────────────────┐    │  │
│  │  │              Global Policies                     │    │  │
│  │  └─────────────────────────────────────────────────┘    │  │
│  │                                                         │  │
│  └─────────────────────────────────────────────────────────┘  │
│                                                               │
└───────────────────────────────────────────────────────────────┘

┌───────────────────┐  ┌───────────────────┐  ┌───────────────────┐
│                   │  │                   │  │                   │
│  Project A        │  │  Project B        │  │  Project C        │
│  Resource Group   │  │  Resource Group   │  │  Resource Group   │
│                   │  │                   │  │                   │
│  ┌─────────────┐  │  │  ┌─────────────┐  │  │  ┌─────────────┐  │
│  │ Function    │  │  │  │ Function    │  │  │  │ Function    │  │
│  │ App         │──┼──┼──┼─▶App         │──┼──┼──┼─▶App         │  │
│  └─────────────┘  │  │  └─────────────┘  │  │  └─────────────┘  │
│                   │  │                   │  │                   │
└───────────────────┘  └───────────────────┘  └───────────────────┘
        │                      │                      │
        │                      │                      │
        ▼                      ▼                      ▼
    References            References             References
   Shared APIM           Shared APIM            Shared APIM
```

## Dedicated APIM Mode Architecture

```
┌───────────────────────────────┐  ┌───────────────────────────────┐  ┌───────────────────────────────┐
│                               │  │                               │  │                               │
│     Project A Resource Group  │  │     Project B Resource Group  │  │     Project C Resource Group  │
│                               │  │                               │  │                               │
│  ┌─────────────────────────┐  │  │  ┌─────────────────────────┐  │  │  ┌─────────────────────────┐  │
│  │                         │  │  │  │                         │  │  │  │                         │  │
│  │    Project A APIM       │  │  │  │    Project B APIM       │  │  │  │    Project C APIM       │  │
│  │                         │  │  │  │                         │  │  │  │                         │  │
│  │  ┌─────────────┐        │  │  │  │  ┌─────────────┐        │  │  │  │  ┌─────────────┐        │  │
│  │  │ API 1       │        │  │  │  │  │ API 1       │        │  │  │  │  │ API 1       │        │  │
│  │  └─────────────┘        │  │  │  │  └─────────────┘        │  │  │  │  └─────────────┘        │  │
│  │                         │  │  │  │                         │  │  │  │                         │  │
│  │  ┌─────────────┐        │  │  │  │  ┌─────────────┐        │  │  │  │  ┌─────────────┐        │  │
│  │  │ API 2       │        │  │  │  │  │ API 2       │        │  │  │  │  │ API 2       │        │  │
│  │  └─────────────┘        │  │  │  │  └─────────────┘        │  │  │  │  └─────────────┘        │  │
│  │                         │  │  │  │                         │  │  │  │                         │  │
│  │  ┌─────────────┐        │  │  │  │  ┌─────────────┐        │  │  │  │  ┌─────────────┐        │  │
│  │  │ Product A   │        │  │  │  │  │ Product B   │        │  │  │  │  │ Product C   │        │  │
│  │  └─────────────┘        │  │  │  │  └─────────────┘        │  │  │  │  └─────────────┘        │  │
│  │                         │  │  │  │                         │  │  │  │                         │  │
│  │  ┌─────────────┐        │  │  │  │  ┌─────────────┐        │  │  │  │  ┌─────────────┐        │  │
│  │  │ Policies    │        │  │  │  │  │ Policies    │        │  │  │  │  │ Policies    │        │  │
│  │  └─────────────┘        │  │  │  │  └─────────────┘        │  │  │  │  └─────────────┘        │  │
│  │                         │  │  │  │                         │  │  │  │                         │  │
│  └─────────────────────────┘  │  │  └─────────────────────────┘  │  │  └─────────────────────────┘  │
│                               │  │                               │  │                               │
│  ┌─────────────┐              │  │  ┌─────────────┐              │  │  ┌─────────────┐              │
│  │ Function    │              │  │  │ Function    │              │  │  │ Function    │              │
│  │ App         │              │  │  │ App         │              │  │  │ App         │              │
│  └─────────────┘              │  │  └─────────────┘              │  │  └─────────────┘              │
│                               │  │                               │  │                               │
└───────────────────────────────┘  └───────────────────────────────┘  └───────────────────────────────┘
```

## API Path Structure Comparison

### Shared Mode Path Structure
```
https://{shared-apim-name}.azure-api.net/{projectName}/{apiVersion}/{apiPath}
```

Example:
```
https://central-apim.azure-api.net/projectA/v1/users
https://central-apim.azure-api.net/projectB/v1/products
```

### Dedicated Mode Path Structure
```
https://{projectName}-apim.azure-api.net/{apiPath}
```

Example:
```
https://projectA-apim.azure-api.net/users
https://projectB-apim.azure-api.net/products
```

## Policy Scope Hierarchy

```
┌─────────────────────────────────┐
│        Global Policies          │
└─────────────────────────────────┘
               │
               ▼
┌─────────────────────────────────┐
│        Product Policies         │
└─────────────────────────────────┘
               │
               ▼
┌─────────────────────────────────┐
│          API Policies           │
└─────────────────────────────────┘
               │
               ▼
┌─────────────────────────────────┐
│       Operation Policies        │
└─────────────────────────────────┘
```
